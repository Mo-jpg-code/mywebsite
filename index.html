<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPhone 15 Pro - The Definition of Pro</title>
    <style>
        :root {
            --bg-color: #000000;
            --text-primary: #ffffff; /* Brighter white for main text */
            --text-secondary: #b0b0b5; /* Slightly lighter secondary */
            --accent-color: #007fff; /* Vivid Apple Blue */
            --phone-titanium-base: #38383a;
            --phone-titanium-highlight: #606063;
            --phone-titanium-shadow: #202022;
            --screen-glass-reflection: rgba(150, 180, 255, 0.08);
            --dynamic-island-color: #000;
            --font-main: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
            --ease-apple: cubic-bezier(0.65, 0, 0.35, 1); /* Smoother, more responsive Apple ease */
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Reset and Base */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            width: 100%; height: 100%; overflow: hidden;
            background-color: var(--bg-color); color: var(--text-primary);
            font-family: var(--font-main);
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            overscroll-behavior: none; display: flex; justify-content: center; align-items: center;
        }

        /* Main Ad Container */
        .ad-world {
            width: 100%; height: 100%; position: relative;
            perspective: 1800px; /* Deeper perspective */
            transform-style: preserve-3d;
        }

        /* Scene Management */
        .scene {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden;
            transition: opacity 1s var(--ease-apple), visibility 0s linear 1s;
            transform-style: preserve-3d; padding: 6vmin;
            will-change: opacity, transform; /* Performance hint */
        }
        .scene.active { opacity: 1; visibility: visible; transition-delay: 0s; z-index: 10; }
        .scene.exiting { opacity: 0; visibility: hidden; transition-duration: 0.7s; z-index: 5; }

        /* Background Canvas Effects */
        #effects-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none; filter: url(#background-effects);
        }

        /* iPhone 3D Mockup - Highly Detailed */
        .iphone-rig { /* Handles global position and major rotations */
            width: 45vmin; height: 90vmin; max-width: 210px; max-height: 420px;
            position: absolute; top: 50%; left: 50%;
            transform-style: preserve-3d;
            transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg) scale(1); /* Initial base state */
            transition: transform 2s var(--ease-out-expo);
            z-index: 100;
            will-change: transform;
        }

        .iphone-assembly { /* Contains all phone parts, handles finer 3D transforms */
            width: 100%; height: 100%;
            position: relative; transform-style: preserve-3d;
            transform: scale(0.7) rotateX(20deg) rotateY(30deg); /* Initial pre-reveal state */
            opacity: 0;
            transition: transform 1.8s var(--ease-apple), opacity 1.5s var(--ease-apple);
            will-change: transform, opacity;
        }
        .iphone-assembly.revealed {
            transform: scale(1) rotateX(0deg) rotateY(0deg);
            opacity: 1;
        }

        .iphone-part { position: absolute; transform-style: preserve-3d; }

        .iphone-body-main { /* Main chassis */
            width: 100%; height: 100%;
            border-radius: 7.5vmin;
            background: linear-gradient(135deg, var(--phone-titanium-highlight) 0%, var(--phone-titanium-base) 60%, var(--phone-titanium-shadow) 100%);
            transform: translateZ(-1.2vmin); /* Depth of phone */
            box-shadow: 0 1vmin 4vmin rgba(0,0,0,0.3), inset 0 0 0.5vmin rgba(255,255,255,0.05);
        }

        /* Frame Sides (Simulated with multiple elements for better 3D) */
        .iphone-frame-side {
            background-color: var(--phone-titanium-base);
            box-shadow: inset 0 0 1vmin rgba(0,0,0,0.2);
        }
        .frame-top    { width: calc(100% - 1.6vmin); height: 0.8vmin; top: 0.4vmin; left: 0.8vmin; transform: rotateX(90deg) translateZ(calc(0.8vmin / 2)); border-radius:0.5vmin 0.5vmin 0 0;}
        .frame-bottom { width: calc(100% - 1.6vmin); height: 0.8vmin; bottom: 0.4vmin; left: 0.8vmin; transform: rotateX(-90deg) translateZ(calc(0.8vmin / 2)); border-radius:0.5vmin 0.5vmin 0 0;}
        .frame-left   { width: 0.8vmin; height: calc(100% - 1.6vmin); left: 0.4vmin; top: 0.8vmin; transform: rotateY(-90deg) translateZ(calc(0.8vmin / 2)); border-radius:0.5vmin 0.5vmin 0 0;}
        .frame-right  { width: 0.8vmin; height: calc(100% - 1.6vmin); right: 0.4vmin; top: 0.8vmin; transform: rotateY(90deg) translateZ(calc(0.8vmin / 2)); border-radius:0.5vmin 0.5vmin 0 0;}


        .iphone-screen-module { /* Screen assembly, slightly proud */
            width: calc(100% - 1.6vmin); height: calc(100% - 1.6vmin);
            top: 0.8vmin; left: 0.8vmin; /* Centering within frame */
            background-color: var(--screen-glass-reflection); /* Simulates glass */
            border-radius: 6vmin;
            transform: translateZ(0.1vmin); /* Screen proudness */
            overflow: hidden;
            display: flex; flex-direction: column; align-items: center; padding-top: 3.5%;
            box-shadow: inset 0 0 1.5vmin rgba(0,0,0,0.6); /* Inner shadow for depth */
        }
        .actual-screen-content { /* The black display area */
            width: 100%; height: 100%; position: absolute; top:0; left:0;
            background-color: #030303; /* Deep black for screen */
            z-index: 1;
        }

        .dynamic-island {
            width: 32%; min-width: 70px; height: 4.8%; min-height: 15px;
            background-color: var(--dynamic-island-color);
            border-radius: 2.2vmin;
            position: relative; z-index: 10; /* Above screen content */
            transition: all 0.6s var(--ease-apple);
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            will-change: width, height, transform;
        }
        .dynamic-island-content {
            opacity: 0; transform: scale(0.8);
            transition: opacity 0.4s var(--ease-apple) 0.2s, transform 0.4s var(--ease-apple) 0.2s;
            color: white; font-size: 2.2vmin; font-weight: 500; white-space: nowrap;
        }
        .dynamic-island.expanded .dynamic-island-content { opacity: 1; transform: scale(1); }

        /* Buttons and Camera Bump */
        .iphone-button {
            background-color: var(--phone-titanium-base);
            border: 0.1vmin solid var(--phone-titanium-shadow);
            border-radius: 0.4vmin;
            box-shadow: 0 0.1vmin 0.2vmin rgba(0,0,0,0.4);
            transition: transform 0.2s var(--ease-apple);
        }
        .iphone-button.pressed { transform: scale(0.95) translateZ(-0.1vmin); }

        .action-button { width: 1.2vmin; height: 7vmin; top: 18%; left: -0.2vmin; transform: translateZ(calc(0.8vmin / 2)) rotateY(-90deg) translateX(50%); }
        .volume-up     { width: 1.2vmin; height: 5vmin; top: 30%; left: -0.2vmin; transform: translateZ(calc(0.8vmin / 2)) rotateY(-90deg) translateX(50%); }
        .volume-down   { width: 1.2vmin; height: 5vmin; top: 38%; left: -0.2vmin; transform: translateZ(calc(0.8vmin / 2)) rotateY(-90deg) translateX(50%); }
        .power-button  { width: 1.2vmin; height: 8vmin; top: 25%; right: -0.2vmin; transform: translateZ(calc(0.8vmin / 2)) rotateY(90deg) translateX(-50%); }

        .camera-bump {
            width: 35%; height: 18%;
            background-color: rgba(0,0,0,0.15); /* Slightly darker than screen glass */
            border-radius: 3vmin;
            position: absolute; top: 5%; right: 5%;
            transform: translateZ(0.3vmin); /* Bump proudness */
            box-shadow: 0 0.3vmin 1vmin rgba(0,0,0,0.2);
            display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1vmin; padding: 1.5vmin;
        }
        .camera-lens {
            width: 100%; height: 100%;
            background: radial-gradient(circle at 30% 30%, #555, #222 60%, #111 90%);
            border-radius: 50%;
            border: 0.2vmin solid #1a1a1a;
            box-shadow: inset 0 0 0.5vmin rgba(0,0,0,0.7);
        }
        .camera-lens.main { grid-column: 1 / 2; grid-row: 1 / 3; transform: scale(1.3) translate(-0.5vmin, 0.5vmin); }
        .camera-lens.ultrawide { /* Auto placed */ }
        .camera-lens.telephoto { /* Auto placed */ }
        .lidar-sensor { background: #111; border-radius: 50%; /* Auto placed */ }

        /* 3D Text Styling */
        .text-3d {
            font-weight: 700; /* Bold for 3D effect */
            color: var(--text-primary);
            position: relative;
            transform-style: preserve-3d;
            opacity: 0; transform: translateY(50px) rotateX(-30deg);
            transition: opacity 1s var(--ease-apple), transform 1s var(--ease-apple);
            text-shadow: 
                0px 1px 0px #c0c0c0,
                0px 2px 0px #b0b0b0,
                0px 3px 0px #a0a0a0,
                0px 4px 0px #909090,
                0px 5px 0px #808080,
                0px 6px 0px #707070,
                0px 7px 8px rgba(0,0,0,0.3), /* Main shadow */
                0px 0px 10px rgba(255,255,255,0.2); /* Subtle glow */
        }
        .text-3d.visible { opacity: 1; transform: translateY(0px) rotateX(0deg); }
        .title-main-3d { font-size: clamp(8vmin, 10vw, 12vmin); transition-delay: 0.3s; }
        .title-feature-3d { font-size: clamp(6vmin, 8vw, 10vmin); margin-top: max(8vh, 40px); }

        .text-standard {
            font-weight: 500; color: var(--text-secondary); text-align: center;
            opacity: 0; transform: translateY(20px);
            transition: opacity 0.8s var(--ease-apple) 0.6s, transform 0.8s var(--ease-apple) 0.6s;
        }
        .text-standard.visible { opacity: 1; transform: translateY(0px); }
        .text-tagline { font-size: clamp(3.5vmin, 4.5vw, 5vmin); }

        /* Specific Scene Styles & Elements */
        /* Scene 0: Abstract Intro */
        #scene0 .title-main-3d { font-size: clamp(6vmin, 8vw, 10vmin); }
        
        /* Scene 3: Titanium */
        .titanium-texture-overlay { /* On screen, animated to show "material" quality */
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(45deg, rgba(200,200,210,0) 0%, rgba(200,200,210,0.05) 40%, rgba(200,200,210,0.15) 50%, rgba(200,200,210,0.05) 60%, rgba(200,200,210,0) 100%);
            background-size: 300% 300%;
            animation: titaniumShine 4s var(--ease-apple) infinite alternate;
            opacity: 0; transition: opacity 1s;
            z-index: 5;
        }
        @keyframes titaniumShine {
            0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; }
        }

        /* Scene 4: Action Button Focus */
        .action-button-highlight {
            position: absolute; width: 4vmin; height: 4vmin;
            background-color: var(--accent-color); border-radius: 50%;
            top: 19%; left: -1vmin; /* Near action button */
            opacity: 0; transform: scale(0);
            animation: actionPulse 1.5s var(--ease-apple) 2; /* Pulsate twice */
            z-index: 1;
        }
        @keyframes actionPulse {
            0% { opacity: 0; transform: scale(0); }
            50% { opacity: 0.7; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(0); }
        }

        /* Scene 5: A17 Pro Chip - Neural Network like animation */
        #a17-neural-net {
            position: absolute; top:0; left:0; width:100%; height:100%;
            z-index: 5; /* Inside screen */
            filter: url(#neural-glow);
            opacity: 0; transition: opacity 1s;
        }
        /* JS will populate #a17-neural-net with canvas or SVG for animation */

        /* Scene 6: Camera Focus */
        .camera-focus-effect {
            position: absolute; width: 100%; height: 100%; top:0; left:0; z-index: 20;
            border: 0.5vmin solid var(--accent-color);
            border-radius: 6vmin; /* Match screen radius */
            opacity: 0; transform: scale(1.2);
            animation: cameraFocusPull 1.5s var(--ease-apple) 0.5s;
        }
        @keyframes cameraFocusPull {
            0% { opacity: 0; transform: scale(1.2); }
            50% { opacity: 0.8; transform: scale(0.98); }
            100% { opacity: 0; transform: scale(1); }
        }
        
        /* Scene 8: Final Hero */
        #sceneFinal .iphone-rig { animation: finalPhoneFloat 10s var(--ease-apple) infinite 1s; }
        @keyframes finalPhoneFloat {
            0%   { transform: translate(-50%, -50%) rotateX(5deg) rotateY(-5deg) scale(1.05); }
            25%  { transform: translate(-50%, -50%) rotateX(-5deg) rotateY(10deg) scale(1.08) translateY(-1vmin); }
            50%  { transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg) scale(1.05); }
            75%  { transform: translate(-50%, -50%) rotateX(8deg) rotateY(-10deg) scale(1.08) translateY(1vmin); }
            100% { transform: translate(-50%, -50%) rotateX(5deg) rotateY(-5deg) scale(1.05); }
        }

    </style>
</head>
<body>
    <div class="ad-world">
        <canvas id="effects-canvas"></canvas>

        <div class="iphone-rig" id="phoneRig">
            <div class="iphone-assembly" id="iphoneAssembly">
                <div class="iphone-part iphone-body-main"></div>
                <div class="iphone-part iphone-frame-side frame-top"></div>
                <div class="iphone-part iphone-frame-side frame-bottom"></div>
                <div class="iphone-part iphone-frame-side frame-left"></div>
                <div class="iphone-part iphone-frame-side frame-right"></div>
                
                <div class="iphone-part iphone-button action-button" id="actionButton"></div>
                <div class="iphone-part iphone-button volume-up"></div>
                <div class="iphone-part iphone-button volume-down"></div>
                <div class="iphone-part iphone-button power-button"></div>

                <div class="iphone-part camera-bump">
                    <div class="camera-lens main"></div>
                    <div class="camera-lens ultrawide"></div>
                    <div class="camera-lens telephoto"></div>
                    <div class="lidar-sensor"></div>
                </div>

                <div class="iphone-part iphone-screen-module">
                    <div class="actual-screen-content" id="actualScreen">
                         <div class="titanium-texture-overlay" id="titaniumOverlay"></div>
                         <div id="a17-neural-net"></div>
                    </div>
                    <div class="dynamic-island" id="dynamicIsland">
                        <span class="dynamic-island-content" id="islandContent"></span>
                    </div>
                    <div class="camera-focus-effect" id="cameraFocusEffect"></div>
                </div>
            </div>
        </div>

        <!-- Scenes -->
        <div class="scene" id="scene0"> <!-- Abstract Intro -->
            <h1 class="title-main-3d">A new dimension.</h1>
        </div>
        <div class="scene" id="scene1"> <!-- iPhone Reveal -->
            <h1 class="title-main-3d">iPhone 15 Pro</h1>
            <p class="text-standard text-tagline">Crafted for tomorrow.</p>
        </div>
        <div class="scene" id="scene2"> <!-- Design & Build -->
            <h2 class="title-feature-3d">Design. Elevated.</h2>
            <p class="text-standard text-tagline">Aerospace-grade titanium. Impossibly light, incredibly strong.</p>
        </div>
        <div class="scene" id="scene3"> <!-- Titanium Material -->
            <h2 class="title-feature-3d">Titanium.</h2>
            <p class="text-standard text-tagline">Feel the difference.</p>
        </div>
        <div class="scene" id="scene4"> <!-- Action Button -->
            <h2 class="title-feature-3d">Action Button.</h2>
            <p class="text-standard text-tagline">Your fast track to favorite features.</p>
            <div class="action-button-highlight" id="actionButtonHighlight"></div>
        </div>
        <div class="scene" id="scene5"> <!-- A17 Pro Chip -->
            <h2 class="title-feature-3d">A17 Pro.</h2>
            <p class="text-standard text-tagline">Game-changing chip. Pro-level performance.</p>
        </div>
        <div class="scene" id="scene6"> <!-- Camera System -->
            <h2 class="title-feature-3d">Pro Camera System.</h2>
            <p class="text-standard text-tagline">Capture your world in breathtaking detail.</p>
        </div>
        <div class="scene" id="scene7"> <!-- Dynamic Island -->
            <h2 class="title-feature-3d">Dynamic Island.</h2>
            <p class="text-standard text-tagline">Fluid. Intuitive. Magically interactive.</p>
        </div>
        <div class="scene" id="sceneFinal"> <!-- Hero Shot -->
            <h1 class="title-main-3d">iPhone 15 Pro</h1>
            <p class="text-standard text-tagline" style="color: var(--text-primary); font-weight:600; letter-spacing:0.02em;">The Definition of Pro.</p>
        </div>
    </div>

    <svg width="0" height="0" style="position:absolute;visibility:hidden;">
        <defs>
            <filter id="background-effects">
                <feTurbulence type="fractalNoise" baseFrequency="0.005 0.01" numOctaves="3" seed="2" result="noise"/>
                <feGaussianBlur in="noise" stdDeviation="1.5" result="blurredNoise"/>
                <feColorMatrix in="blurredNoise" type="matrix"
                    values="1 0 0 0 0
                            0 1 0 0 0
                            0 0 1 0 0
                            0 0 0 0.25 0" result="subtleNoise"/>
                <!-- Could add feDiffuseLighting here for more depth -->
            </filter>
            <filter id="neural-glow">
                <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur"/>
                <feFlood flood-color="var(--accent-color)" flood-opacity="0.7" result="flood"/>
                <feComposite in="flood" in2="blur" operator="in" result="glow"/>
                <feMerge>
                    <feMergeNode in="glow"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            </filter>
        </defs>
    </svg>

    <script>
    // --- Configuration ---
    const SCENES_CONFIG = [
        { id: 'scene0', duration: 4000, phone: { revealed: false, rotX: 10, rotY: 20, scale: 0.9 } },
        { id: 'scene1', duration: 5000, phone: { revealed: true, rotX: 5, rotY: -10, scale: 1 } },
        { id: 'scene2', duration: 5000, phone: { rotX: 0, rotY: 15, scale: 1.05 } },
        { id: 'scene3', duration: 4500, phone: { rotX: 10, rotY: -5, scale: 1.1 }, effects: ['titaniumShine'] },
        { id: 'scene4', duration: 5000, phone: { rotX: 5, rotY: 25, scale: 1.1 }, interactive: ['actionButtonPress'] },
        { id: 'scene5', duration: 6000, phone: { rotX: 0, rotY: 0, scale: 1.15 }, effects: ['a17NeuralNet'] },
        { id: 'scene6', duration: 5500, phone: { rotX: -5, rotY: -20, scale: 1.1 }, effects: ['cameraFocus'] },
        { id: 'scene7', duration: 5000, phone: { rotX: 0, rotY: 0, scale: 1.1 }, interactive: ['dynamicIslandDemo'] },
        { id: 'sceneFinal', duration: 8000, phone: { isHero: true } } // Hero animation handled by CSS
    ];
    let currentSceneIdx = -1;
    let sceneTimeoutId;

    // --- DOM Elements ---
    const phoneRig = document.getElementById('phoneRig');
    const iphoneAssembly = document.getElementById('iphoneAssembly');
    const dynamicIslandEl = document.getElementById('dynamicIsland');
    const islandContentEl = document.getElementById('islandContent');
    const titaniumOverlayEl = document.getElementById('titaniumOverlay');
    const actionButtonEl = document.getElementById('actionButton');
    const actionButtonHighlightEl = document.getElementById('actionButtonHighlight');
    const a17NeuralNetEl = document.getElementById('a17-neural-net'); // Placeholder for canvas or SVG
    const cameraFocusEffectEl = document.getElementById('cameraFocusEffect');
    const effectsCanvas = document.getElementById('effects-canvas');
    const effectsCtx = effectsCanvas.getContext('2d');

    // --- Background Canvas Particle System ---
    let bgParticles = [];
    const BG_PARTICLE_COUNT = 50;
    function resizeEffectsCanvas() {
        effectsCanvas.width = window.innerWidth;
        effectsCanvas.height = window.innerHeight;
    }
    class BgParticle {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * effectsCanvas.width;
            this.y = Math.random() * effectsCanvas.height;
            this.z = Math.random() * 0.8 + 0.2; // Depth for parallax
            this.size = (Math.random() * 1.5 + 0.5) * this.z;
            this.opacity = (Math.random() * 0.3 + 0.1) * this.z;
            this.vx = (Math.random() - 0.5) * 0.2 * this.z;
            this.vy = (Math.random() - 0.5) * 0.2 * this.z;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x > effectsCanvas.width + this.size || this.x < -this.size ||
                this.y > effectsCanvas.height + this.size || this.y < -this.size) {
                this.reset(); // Re-spawn if out of bounds
            }
        }
        draw() {
            effectsCtx.beginPath();
            effectsCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            effectsCtx.fillStyle = `rgba(180, 200, 255, ${this.opacity})`;
            effectsCtx.fill();
        }
    }
    function initBgParticles() {
        for (let i = 0; i < BG_PARTICLE_COUNT; i++) bgParticles.push(new BgParticle());
    }
    function animateBgParticles() {
        effectsCtx.clearRect(0, 0, effectsCanvas.width, effectsCanvas.height);
        bgParticles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animateBgParticles);
    }

    // --- A17 Neural Net Simulation (Simple Canvas) ---
    let neuralNodes = [];
    let neuralLinks = [];
    const NEURAL_NODE_COUNT = 25;
    const NEURAL_LINK_PROBABILITY = 0.1;
    let neuralCanvas, neuralCtx;

    function initNeuralNetVisuals() {
        if (!neuralCanvas) {
            neuralCanvas = document.createElement('canvas');
            a17NeuralNetEl.appendChild(neuralCanvas);
            neuralCtx = neuralCanvas.getContext('2d');
        }
        neuralCanvas.width = a17NeuralNetEl.offsetWidth;
        neuralCanvas.height = a17NeuralNetEl.offsetHeight;
        neuralNodes = []; neuralLinks = [];
        for (let i = 0; i < NEURAL_NODE_COUNT; i++) {
            neuralNodes.push({
                x: Math.random() * neuralCanvas.width,
                y: Math.random() * neuralCanvas.height,
                radius: Math.random() * 2 + 1,
                opacity: 0,
                targetOpacity: Math.random() * 0.6 + 0.2,
                vx: (Math.random() - 0.5) * 0.3,
                vy: (Math.random() - 0.5) * 0.3
            });
        }
        for (let i = 0; i < NEURAL_NODE_COUNT; i++) {
            for (let j = i + 1; j < NEURAL_NODE_COUNT; j++) {
                if (Math.random() < NEURAL_LINK_PROBABILITY) {
                    neuralLinks.push({ n1: neuralNodes[i], n2: neuralNodes[j], opacity: 0, targetOpacity: Math.random() * 0.3 + 0.1 });
                }
            }
        }
    }
    let neuralAnimationActive = false;
    function animateNeuralNet() {
        if (!neuralAnimationActive || !neuralCtx) return;
        neuralCtx.clearRect(0, 0, neuralCanvas.width, neuralCanvas.height);
        neuralNodes.forEach(node => {
            node.x += node.vx; node.y += node.vy;
            if (node.x < 0 || node.x > neuralCanvas.width) node.vx *= -1;
            if (node.y < 0 || node.y > neuralCanvas.height) node.vy *= -1;
            node.opacity += (node.targetOpacity - node.opacity) * 0.05; // Smooth fade in
            neuralCtx.beginPath();
            neuralCtx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
            neuralCtx.fillStyle = `rgba(0, 127, 255, ${node.opacity})`;
            neuralCtx.fill();
        });
        neuralLinks.forEach(link => {
            link.opacity += (link.targetOpacity - link.opacity) * 0.05;
            neuralCtx.beginPath();
            neuralCtx.moveTo(link.n1.x, link.n1.y);
            neuralCtx.lineTo(link.n2.x, link.n2.y);
            neuralCtx.strokeStyle = `rgba(0, 127, 255, ${link.opacity * 0.5})`;
            neuralCtx.lineWidth = 0.5;
            neuralCtx.stroke();
        });
        requestAnimationFrame(animateNeuralNet);
    }


    // --- Scene & Animation Control ---
    function resetSceneEffects() {
        titaniumOverlayEl.style.opacity = '0';
        actionButtonHighlightEl.style.animation = 'none'; // Allow re-trigger
        a17NeuralNetEl.style.opacity = '0';
        neuralAnimationActive = false;
        cameraFocusEffectEl.style.animation = 'none';
        dynamicIslandEl.classList.remove('expanded');
        islandContentEl.textContent = '';
    }

    function triggerSceneEffects(config) {
        if (!config.effects && !config.interactive) return;

        (config.effects || []).forEach(effect => {
            if (effect === 'titaniumShine') titaniumOverlayEl.style.opacity = '0.6';
            if (effect === 'a17NeuralNet') {
                a17NeuralNetEl.style.opacity = '1';
                initNeuralNetVisuals();
                neuralAnimationActive = true;
                animateNeuralNet();
            }
            if (effect === 'cameraFocus') {
                cameraFocusEffectEl.style.animation = 'cameraFocusPull 1.5s var(--ease-apple) 0.5s forwards';
            }
        });
        
        (config.interactive || []).forEach(interaction => {
            if (interaction === 'actionButtonPress') {
                actionButtonHighlightEl.style.animation = ''; // Reset for re-trigger
                void actionButtonHighlightEl.offsetWidth; // Force reflow
                actionButtonHighlightEl.style.animation = 'actionPulse 1.5s var(--ease-apple) forwards';
                setTimeout(() => actionButtonEl.classList.add('pressed'), 500);
                setTimeout(() => actionButtonEl.classList.remove('pressed'), 800);
                // Dynamic Island quick interaction
                setTimeout(() => showDynamicIslandContent("ðŸ“¸ Camera", 1500), 600);
            }
            if (interaction === 'dynamicIslandDemo') {
                setTimeout(() => showDynamicIslandContent("âœˆï¸ Flight A123", 3000, true), 500);
            }
        });
    }
    
    function showDynamicIslandContent(text, duration, expandMore = false) {
        dynamicIslandEl.classList.add('expanded');
        if(expandMore) {
            dynamicIslandEl.style.width = '60%';
            dynamicIslandEl.style.height = '7%';
        } else {
            dynamicIslandEl.style.width = '45%';
            dynamicIslandEl.style.height = '6%';
        }
        islandContentEl.textContent = text;
        setTimeout(() => {
            dynamicIslandEl.classList.remove('expanded');
            dynamicIslandEl.style.width = ''; // Revert to CSS default
            dynamicIslandEl.style.height = '';
            islandContentEl.textContent = '';
        }, duration);
    }

    function updatePhoneTransform(config) {
        if (config.phone.isHero) { // Hero state might have its own CSS animation
            phoneRig.style.transition = 'transform 2s var(--ease-apple)'; // Ensure smooth transition to hero anim
            phoneRig.style.transform = `translate(-50%, -50%) rotateX(0deg) rotateY(0deg) scale(1.05)`; // Base for CSS hero animation
        } else {
             phoneRig.style.transition = 'transform 2s var(--ease-out-expo)'; // Default transition
            phoneRig.style.transform = `translate(-50%, -50%) rotateX(${config.phone.rotX || 0}deg) rotateY(${config.phone.rotY || 0}deg) scale(${config.phone.scale || 1})`;
        }
        
        if (config.phone.revealed !== undefined) {
            config.phone.revealed ? iphoneAssembly.classList.add('revealed') : iphoneAssembly.classList.remove('revealed');
        }
    }

    function playNextScene() {
        clearTimeout(sceneTimeoutId);
        resetSceneEffects(); // Reset effects from previous scene

        if (currentSceneIdx > -1) {
            const oldSceneEl = document.getElementById(SCENES_CONFIG[currentSceneIdx].id);
            if (oldSceneEl) {
                oldSceneEl.classList.remove('active');
                oldSceneEl.classList.add('exiting');
                oldSceneEl.querySelectorAll('.text-3d, .text-standard').forEach(el => el.classList.remove('visible'));
            }
        }

        currentSceneIdx = (currentSceneIdx + 1) % SCENES_CONFIG.length;
        const currentConfig = SCENES_CONFIG[currentSceneIdx];
        const currentSceneEl = document.getElementById(currentConfig.id);

        document.querySelectorAll('.scene.exiting').forEach(s => {
             if (s !== currentSceneEl) s.classList.remove('exiting'); // Clean up just in case
        });

        currentSceneEl.classList.add('active');
        currentSceneEl.querySelectorAll('.text-3d, .text-standard').forEach(el => {
            void el.offsetWidth; // Reflow for transition
            el.classList.add('visible');
        });

        updatePhoneTransform(currentConfig);
        triggerSceneEffects(currentConfig);

        sceneTimeoutId = setTimeout(playNextScene, currentConfig.duration);
    }

    // --- Initialization ---
    window.onload = () => {
        resizeEffectsCanvas();
        window.addEventListener('resize', resizeEffectsCanvas);
        initBgParticles();
        animateBgParticles();
        playNextScene();
    };
    </script>
</body>
</html>
