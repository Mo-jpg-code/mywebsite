<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Funny Chemical Simulator</title>
    <style>
        /* Basic Reset & Global Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Marker Felt', sans-serif;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align to top */
            min-height: 100vh;
            background: linear-gradient(135deg, #f0f0f0, #c0c0c0);
            color: #333;
            padding: 10px;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        /* App Container */
        #app-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 450px; /* Max width for larger phones/tablets */
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            padding: 15px;
        }

        h1 {
            color: #5D3FD3; /* Fun purple */
            margin-bottom: 15px;
            font-size: 1.8em;
            text-align: center;
        }

        /* Chemical Selector */
        #chemical-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            width: 100%;
            margin-bottom: 15px;
        }

        .chemical-btn {
            padding: 12px 8px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            color: white;
            min-height: 60px; /* Ensure buttons have some height */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .chemical-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .chemical-btn.selected {
            border-color: #FFD700; /* Gold border for selected */
            transform: scale(1.05);
            box-shadow: 0 0 10px #FFD700;
        }

        /* Beaker (Canvas) Area */
        #beaker-area {
            width: 100%;
            max-width: 300px; /* Control beaker size */
            aspect-ratio: 3/4; /* Maintain beaker proportions */
            margin: 0 auto 15px auto;
            position: relative;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 133"><path d="M10 130 Q50 135 90 130 L95 10 Q50 0 5 10 Z" fill="rgba(200,220,255,0.2)" stroke="%238888AA" stroke-width="3"/><line x1="15" y1="30" x2="25" y2="30" stroke="%238888AA" stroke-width="2"/><line x1="15" y1="50" x2="25" y2="50" stroke="%238888AA" stroke-width="2"/><line x1="15" y1="70" x2="25" y2="70" stroke="%238888AA" stroke-width="2"/><line x1="15" y1="90" x2="25" y2="90" stroke="%238888AA" stroke-width="2"/><line x1="15" y1="110" x2="25" y2="110" stroke="%238888AA" stroke-width="2"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        #reaction-canvas {
            position: absolute;
            top: 5%; /* Adjust to fit inside SVG beaker visual */
            left: 6%;
            width: 88%;
            height: 90%;
            /* background-color: rgba(255,0,0,0.1); for debugging bounds */
        }

        /* Message Area */
        #message-area {
            width: 100%;
            min-height: 50px;
            padding: 10px;
            margin-bottom: 15px;
            background-color: #e0e0ff;
            border: 1px dashed #5D3FD3;
            border-radius: 8px;
            text-align: center;
            font-style: italic;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Controls */
        #controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
        }

        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            color: white;
        }

        #mix-btn { background-color: #4CAF50; /* Green */ }
        #mix-btn:hover { background-color: #45a049; }
        #mix-btn:disabled { background-color: #cccccc; cursor: not-allowed; }

        #clear-btn { background-color: #f44336; /* Red */ }
        #clear-btn:hover { background-color: #da190b; }

    </style>
</head>
<body>
    <div id="app-container">
        <h1>Wacky Chem Lab!</h1>

        <div id="chemical-selector">
            <!-- Chemical buttons will be generated by JS -->
        </div>

        <div id="beaker-area">
            <canvas id="reaction-canvas"></canvas>
        </div>

        <div id="message-area">
            <p id="reaction-message">Select two chemicals and hit Mix!</p>
        </div>

        <div id="controls">
            <button id="mix-btn" class="control-btn" disabled>Mix!</button>
            <button id="clear-btn" class="control-btn">Clear</button>
        </div>
    </div>

    <script>
        // --- Global Variables & Constants ---
        const chemicals = [
            { id: 'giggle', name: 'Giggle Gas', color: '#FF69B4', description: "Warning: May cause uncontrollable chuckles." },
            { id: 'slime', name: 'Slime Sauce', color: '#32CD32', description: "It's gooey, it's green, it's... science?" },
            { id: 'boom', name: 'Boom Powder', color: '#FF4500', description: "Handle with EXTREME care (or don't)." },
            { id: 'sparkle', name: 'Sparkle Potion', color: '#8A2BE2', description: "Makes everything fabulously glittery!" },
            { id: 'stink', name: 'Stench Bomb', color: '#8B4513', description: "Pee-yew! Smells like old socks and regret." },
            { id: 'shrink', name: 'Shrinky Dink Fluid', color: '#00CED1', description: "Makes things adorably tiny."}
        ];

        let selectedChemicals = [];
        const chemicalSelectorDiv = document.getElementById('chemical-selector');
        const mixBtn = document.getElementById('mix-btn');
        const clearBtn = document.getElementById('clear-btn');
        const reactionMessageEl = document.getElementById('reaction-message');
        
        const canvas = document.getElementById('reaction-canvas');
        const ctx = canvas.getContext('2d');
        let canvasWidth, canvasHeight;
        let animationFrameId = null;
        let particles = []; // For visual effects
        let currentBeakerLiquid = { color: 'rgba(200,220,255,0.1)', level: 0 }; // level 0 to 1

        // --- Canvas & Animation Utilities ---
        function resizeCanvas() {
            const beakerArea = document.getElementById('beaker-area');
            // Set canvas internal resolution to its display size
            canvas.width = canvas.getBoundingClientRect().width;
            canvas.height = canvas.getBoundingClientRect().height;
            canvasWidth = canvas.width;
            canvasHeight = canvas.height;
            drawBeakerContents(); // Redraw after resize
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        }

        // --- Particle System (Simple) ---
        class Particle {
            constructor(x, y, vx, vy, radius, color, life) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.radius = radius;
                this.color = color;
                this.life = life;
                this.initialLife = life;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1; // Gravity
                this.life--;
                this.alpha = Math.max(0, this.life / this.initialLife);
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color.replace(')', `, ${this.alpha})`).replace('rgb(', 'rgba(');
                ctx.fill();
            }
        }

        function animate() {
            clearCanvas();
            drawBeakerContents();

            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw();
            });

            if (particles.length > 0 || (currentBeakerLiquid.targetLevel && Math.abs(currentBeakerLiquid.level - currentBeakerLiquid.targetLevel) > 0.01)) {
                // Animate liquid level change
                if (currentBeakerLiquid.targetLevel) {
                    currentBeakerLiquid.level += (currentBeakerLiquid.targetLevel - currentBeakerLiquid.level) * 0.1;
                     if (Math.abs(currentBeakerLiquid.level - currentBeakerLiquid.targetLevel) <= 0.01) {
                        currentBeakerLiquid.level = currentBeakerLiquid.targetLevel;
                        delete currentBeakerLiquid.targetLevel; // Stop animating level once reached
                    }
                }
                animationFrameId = requestAnimationFrame(animate);
            } else {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        }

        function startAnimation() {
            if (!animationFrameId) {
                animate();
            }
        }
        
        function drawBeakerContents() {
            clearCanvas(); // Clear previous frame
            if (currentBeakerLiquid.level > 0) {
                const liquidHeight = canvasHeight * currentBeakerLiquid.level;
                const liquidY = canvasHeight - liquidHeight;
                
                ctx.fillStyle = currentBeakerLiquid.color;
                ctx.beginPath();
                ctx.moveTo(0, liquidY); // Start left
                // Simple wave effect
                for (let x = 0; x <= canvasWidth; x += 5) {
                    const yOffset = Math.sin((x + Date.now() * 0.002) * 0.1) * 3 * Math.min(1, currentBeakerLiquid.level / 0.2); // More wave for fuller beaker
                    ctx.lineTo(x, liquidY + yOffset);
                }
                ctx.lineTo(canvasWidth, liquidY); // End right before wave
                ctx.lineTo(canvasWidth, canvasHeight); // Bottom right
                ctx.lineTo(0, canvasHeight);    // Bottom left
                ctx.closePath();
                ctx.fill();
            }
        }


        // --- Chemical & Reaction Logic ---
        function populateChemicals() {
            chemicals.forEach(chem => {
                const btn = document.createElement('button');
                btn.classList.add('chemical-btn');
                btn.dataset.id = chem.id;
                btn.textContent = chem.name;
                btn.style.backgroundColor = chem.color;
                // Simple contrast for text
                const brightness = (parseInt(chem.color.slice(1,3), 16) * 299 +
                                    parseInt(chem.color.slice(3,5), 16) * 587 +
                                    parseInt(chem.color.slice(5,7), 16) * 114) / 1000;
                btn.style.color = brightness > 128 ? 'black' : 'white';

                btn.addEventListener('click', () => selectChemical(chem, btn));
                chemicalSelectorDiv.appendChild(btn);
            });
        }

        function selectChemical(chemical, buttonElement) {
            const index = selectedChemicals.findIndex(sc => sc.id === chemical.id);
            if (index > -1) { // Already selected, de-select
                selectedChemicals.splice(index, 1);
                buttonElement.classList.remove('selected');
            } else {
                if (selectedChemicals.length < 2) {
                    selectedChemicals.push(chemical);
                    buttonElement.classList.add('selected');
                } else {
                    // Optional: Notify user they can only select 2
                    reactionMessageEl.textContent = "Max 2 chemicals! Clear selection or unselect one.";
                    setTimeout(() => reactionMessageEl.textContent = "Select two chemicals and hit Mix!", 2000);
                }
            }
            mixBtn.disabled = selectedChemicals.length !== 2;
        }

        function clearSelections() {
            selectedChemicals = [];
            document.querySelectorAll('.chemical-btn.selected').forEach(btn => btn.classList.remove('selected'));
            mixBtn.disabled = true;
            reactionMessageEl.textContent = "Selections cleared. Ready for a new mix!";
            currentBeakerLiquid = { color: 'rgba(200,220,255,0.1)', level: 0, targetLevel: 0 };
            particles = [];
            startAnimation(); // To clear canvas and animate liquid out
        }

        function mixChemicals() {
            if (selectedChemicals.length !== 2) return;

            const [chem1, chem2] = selectedChemicals;
            let reactionText = `Mixing ${chem1.name} and ${chem2.name}... `;
            
            // Ensure consistent order for defining reactions
            const ids = [chem1.id, chem2.id].sort().join('-');

            // Update beaker base color and level
            const r1 = parseInt(chem1.color.slice(1,3),16), g1 = parseInt(chem1.color.slice(3,5),16), b1 = parseInt(chem1.color.slice(5,7),16);
            const r2 = parseInt(chem2.color.slice(1,3),16), g2 = parseInt(chem2.color.slice(3,5),16), b2 = parseInt(chem2.color.slice(5,7),16);
            const mixedR = Math.floor((r1+r2)/2);
            const mixedG = Math.floor((g1+g2)/2);
            const mixedB = Math.floor((b1+b2)/2);
            
            currentBeakerLiquid.color = `rgb(${mixedR},${mixedG},${mixedB})`;
            currentBeakerLiquid.targetLevel = 0.75; // Animate fill to 75%
            particles = []; // Clear old particles

            // --- Define "Funny" Reactions ---
            switch (ids) {
                case 'boom-giggle':
                    reactionText += "KABOOM! ...of laughter! Confetti everywhere!";
                    for (let i = 0; i < 100; i++) {
                        particles.push(new Particle(
                            canvasWidth / 2, canvasHeight * 0.7,
                            (Math.random() - 0.5) * 10, (Math.random() - 0.7) * 10, // Upward burst
                            Math.random() * 5 + 2,
                            `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`,
                            100 + Math.random() * 50
                        ));
                    }
                    break;
                case 'giggle-slime':
                    reactionText += "Wobbly, giggly slime! It's trying to escape!";
                     currentBeakerLiquid.targetLevel = 0.9; // Slime expands
                    for (let i = 0; i < 50; i++) { // Bubbles
                        particles.push(new Particle(
                            Math.random() * canvasWidth * 0.8 + canvasWidth * 0.1, canvasHeight * 0.8,
                            (Math.random() - 0.5) * 1, -(Math.random() * 2 + 1), // Rising bubbles
                            Math.random() * 8 + 4, chem1.color,
                            80 + Math.random() * 40
                        ));
                    }
                    break;
                case 'slime-sparkle':
                    reactionText += "Sparkly, glamorous goo! So shiny!";
                    currentBeakerLiquid.color = chem2.color; // Sparkle color dominates
                    for (let i = 0; i < 150; i++) { // Sparkles
                        particles.push(new Particle(
                            Math.random() * canvasWidth, canvasHeight * (0.25 + Math.random() * 0.5), // within liquid
                            (Math.random() - 0.5) * 0.5, (Math.random() - 0.5) * 0.5, // slow drift
                            Math.random() * 2 + 1, 'white',
                            120 + Math.random() * 60
                        ));
                    }
                    break;
                case 'boom-stink':
                    reactionText += "POOF! A cloud of... questionable aroma. Yikes!";
                    currentBeakerLiquid.color = chem2.color;
                    currentBeakerLiquid.targetLevel = 0.3; // some evaporates
                    for (let i = 0; i < 80; i++) { // Smoke cloud
                        particles.push(new Particle(
                            canvasWidth/2, canvasHeight * 0.6,
                            (Math.random() - 0.5) * 3, -(Math.random() * 1.5 + 0.5), // Rising, spreading smoke
                            Math.random() * 15 + 10, `rgba(100,100,80,0.7)`, // brownish smoke
                            100 + Math.random() * 50
                        ));
                    }
                    break;
                case 'shrink-sparkle':
                    reactionText += "Tiny, shimmering wonders! So cute!";
                    currentBeakerLiquid.targetLevel = 0.2; // It shrinks!
                    for (let i = 0; i < 100; i++) { // Tiny sparkles
                        particles.push(new Particle(
                            Math.random() * canvasWidth, canvasHeight * (0.8 + Math.random() * 0.1), // near bottom
                            (Math.random() - 0.5) * 0.2, (Math.random() - 0.5) * 0.2,
                            Math.random() * 1.5 + 0.5, 'white',
                            100 + Math.random() * 30
                        ));
                    }
                    break;
                case 'giggle-stink':
                    reactionText += "It smells awful, but you can't stop laughing!";
                     for (let i = 0; i < 30; i++) { // Giggle bubbles
                        particles.push(new Particle(
                            Math.random() * canvasWidth * 0.8 + canvasWidth * 0.1, canvasHeight * 0.8,
                            (Math.random() - 0.5) * 1, -(Math.random() * 2 + 1),
                            Math.random() * 6 + 3, chem1.color, 80
                        ));
                    }
                    for (let i = 0; i < 30; i++) { // Stink clouds
                        particles.push(new Particle(
                            Math.random() * canvasWidth * 0.8 + canvasWidth * 0.1, canvasHeight * 0.7,
                            (Math.random() - 0.5) * 1, -(Math.random() * 1 + 0.2),
                            Math.random() * 10 + 5, chem2.color.replace(')', ', 0.5)'), 80 // semi-transparent
                        ));
                    }
                    break;
                // Add more reactions here!
                // e.g. 'boom-shrink', 'slime-stink', 'sparkle-stink', 'shrink-slime', 'boom-sparkle' etc.
                case 'boom-slime':
                    reactionText += "A sticky explosion! Everything is covered in bouncy slime!";
                    currentBeakerLiquid.targetLevel = 0.85;
                    for (let i = 0; i < 70; i++) { // Bouncy slime globs
                        particles.push(new Particle(
                            canvasWidth / 2, canvasHeight * 0.7,
                            (Math.random() - 0.5) * 8, (Math.random() - 0.6) * 9,
                            Math.random() * 8 + 4, chem2.color, // Slime color
                            120 + Math.random() * 60
                        ));
                    }
                     // Make some particles "stick" to beaker walls (visual trick)
                    setTimeout(() => {
                        for(let i=0; i<5; i++) {
                             particles.push(new Particle(
                                Math.random() < 0.5 ? canvasWidth*0.1 : canvasWidth*0.9, canvasHeight * (0.3 + Math.random()*0.4),
                                0,0, // stationary
                                Math.random() * 10 + 5, chem2.color,
                                200 // long life
                            ));
                        }
                        startAnimation();
                    }, 800);
                    break;

                default:
                    reactionText += "Hmm, a curious fizzle. Nothing too dramatic, just a new color perhaps!";
                    // Default gentle fizz
                     for (let i = 0; i < 30; i++) {
                        particles.push(new Particle(
                            Math.random() * canvasWidth * 0.6 + canvasWidth * 0.2, canvasHeight * 0.8,
                            (Math.random() - 0.5) * 0.5, -(Math.random() * 1 + 0.5),
                            Math.random() * 3 + 1, 'white',
                            60 + Math.random() * 30
                        ));
                    }
            }

            reactionMessageEl.textContent = reactionText;
            startAnimation(); // Start animation loop for particles and liquid
            // Auto clear selection for next mix, but keep visuals
            selectedChemicals = [];
            document.querySelectorAll('.chemical-btn.selected').forEach(btn => btn.classList.remove('selected'));
            mixBtn.disabled = true;
        }

        // --- Event Listeners ---
        mixBtn.addEventListener('click', mixChemicals);
        clearBtn.addEventListener('click', clearSelections);
        window.addEventListener('resize', resizeCanvas);
        document.addEventListener('DOMContentLoaded', () => {
            populateChemicals();
            resizeCanvas(); // Initial canvas setup
            // Initial beaker content draw (empty)
            currentBeakerLiquid.level = 0;
            currentBeakerLiquid.targetLevel = 0;
            drawBeakerContents(); 
        });

    </script>
</body>
</html>
