<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IdeaSpark 2025 - Mobile Concept</title>
    <style>
        :root {
            --bg-primary: #101012; /* Even deeper dark */
            --bg-secondary: #1A1A1C;
            --bg-tertiary: #252528;
            --text-primary: #E8E8EA;
            --text-secondary: #A0A0A5;
            --accent-primary: #00CFE8; /* Futuristic Cyan/Teal */
            --accent-secondary: #FF4081; /* Vivid Pink for contrast */
            --border-color: #303033;
            --header-height: 56px;
            --bottom-nav-height: 60px;
            --border-radius-main: 20px; /* Softer, larger radius */
            --border-radius-small: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                         Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue",
                         sans-serif; /* Prioritize SF Pro if available */
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            background-color: #050506;
        }

        .app-shell {
            width: 100%;
            height: 100%;
            max-width: 414px;
            max-height: calc(414px * (16 / 9));
            margin: auto;
            position: relative;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #222;
            border-right: 1px solid #222;
            box-shadow: 0 0 30px rgba(0,0,0,0.6);
        }
         @media (max-width: 450px) {
            .app-shell {
                max-width: 100%;
                max-height: 100%;
                border-left: none;
                border-right: none;
                box-shadow: none;
            }
        }

        /* Page container for view switching */
        .page-content {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
            padding-top: calc(var(--header-height) + 16px);
            padding-bottom: calc(var(--bottom-nav-height) + 16px);
            display: none; /* Hidden by default, shown by JS */
        }
        .page-content.active {
            display: block;
        }

        /* Header Styles */
        .app-header {
            height: var(--header-height);
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: center; /* Center logo typically */
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            max-width: inherit;
            margin: 0 auto;
        }
         .app-header-logo {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--accent-primary);
            letter-spacing: 1px;
         }
         .app-header-logo .sparkle {
            color: var(--accent-secondary);
            font-style: italic;
         }
         .header-action-button { /* For potential right-side actions */
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none; border: none; padding: 8px;
         }
         .header-action-button svg {
            width: 24px; height: 24px; fill: var(--text-secondary);
         }


        /* --- Home Page (Pin Grid) --- */
        .pin-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            align-items: start;
        }
        .pin {
            position: relative;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-main);
            overflow: hidden;
            cursor: pointer;
            color: var(--text-primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: transform 0.2s ease-out;
        }
        .pin:active {
            transform: scale(0.97);
        }
        .pin img {
            width: 100%;
            height: auto;
            display: block;
            border-top-left-radius: var(--border-radius-main);
            border-top-right-radius: var(--border-radius-main);
            background-color: var(--bg-tertiary);
        }
        .pin-content { padding: 10px 14px 14px; }
        .pin-title {
            font-size: 0.9em; font-weight: 600; margin-bottom: 4px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .pin-user { display: flex; align-items: center; font-size: 0.75em; color: var(--text-secondary); }
        .pin-user-avatar {
            width: 20px; height: 20px; border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            margin-right: 6px; display: flex; align-items: center; justify-content: center;
            font-size: 0.7em; font-weight: bold; color: var(--bg-primary);
        }
        .pin-save-button {
            position: absolute;
            top: 10px; right: 10px;
            background-color: rgba(0,0,0,0.6);
            color: white;
            padding: 6px 10px;
            border-radius: var(--border-radius-small);
            font-weight: 600; border: none; cursor: pointer;
            font-size: 0.8em;
            backdrop-filter: blur(5px);
            transition: background-color 0.2s, color 0.2s;
        }
        .pin-save-button.saved {
            background-color: var(--accent-primary);
            color: var(--bg-primary);
        }

        /* --- Discover Page --- */
        #discoverPage .search-bar-container {
            margin-bottom: 20px;
            position: relative;
        }
        #discoverPage .search-input {
            width: 100%;
            padding: 14px 20px;
            padding-left: 48px; /* For icon */
            font-size: 1em;
            border-radius: var(--border-radius-main);
            border: 1px solid var(--border-color);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            outline: none;
        }
         #discoverPage .search-input::placeholder { color: var(--text-secondary); }
         #discoverPage .search-icon {
            position: absolute;
            left: 16px; top: 50%;
            transform: translateY(-50%);
            width: 20px; height: 20px;
            fill: var(--text-secondary);
         }
        .discover-section-title {
            font-size: 1.1em; font-weight: 700;
            margin-bottom: 12px; color: var(--text-primary);
        }
        .category-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .category-tag {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: var(--border-radius-small);
            font-size: 0.85em; font-weight: 500; cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        .category-tag:hover { background-color: var(--accent-primary); color: var(--bg-primary); }
        .mock-search-results .result-item {
            background-color: var(--bg-secondary); padding: 12px; border-radius: var(--border-radius-small);
            margin-bottom: 8px; font-size: 0.9em;
        }

        /* --- Create Page --- */
        .create-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }
        .create-option-card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius-main);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .create-option-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .create-option-card svg {
            width: 36px; height: 36px;
            fill: var(--accent-primary);
            margin-bottom: 12px;
        }
        .create-option-card .ai-sparkle svg { fill: var(--accent-secondary); }
        .create-option-card p { font-size: 0.9em; font-weight: 600; }

        /* --- Updates Page --- */
        .notification-list .notification-item {
            display: flex; align-items: center;
            background-color: var(--bg-secondary);
            padding: 12px 16px;
            border-radius: var(--border-radius-small);
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .notification-icon {
            width: 32px; height: 32px; border-radius: 50%;
            background-color: var(--accent-primary); color: var(--bg-primary);
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px; font-weight: bold;
        }
        .notification-icon.comment { background-color: var(--accent-secondary); }
        .notification-text p { font-size: 0.9em; margin-bottom: 2px; }
        .notification-text .time { font-size: 0.75em; color: var(--text-secondary); }

        /* --- Profile Page --- */
        .profile-header { text-align: center; margin-bottom: 24px; }
        .profile-avatar-large {
            width: 90px; height: 90px; border-radius: 50%;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            margin: 0 auto 12px auto; display: flex; align-items: center; justify-content: center;
            font-size: 2.5em; font-weight: bold; color: var(--bg-primary);
            box-shadow: 0 0 0 4px var(--bg-primary), 0 0 0 6px var(--accent-primary);
        }
        .profile-name { font-size: 1.5em; font-weight: 700; margin-bottom: 4px; }
        .profile-username { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 12px; }
        .profile-stats { display: flex; justify-content: space-around; margin-bottom: 24px; }
        .stat-item { text-align: center; }
        .stat-item .count { font-size: 1.2em; font-weight: 700; }
        .stat-item .label { font-size: 0.8em; color: var(--text-secondary); }
        .profile-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 16px; }
        .profile-tab {
            flex: 1; text-align: center; padding: 12px 0; font-weight: 600;
            color: var(--text-secondary); cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-color 0.2s;
        }
        .profile-tab.active { color: var(--text-primary); border-bottom-color: var(--accent-primary); }
        .profile-tab-content { display: none; }
        .profile-tab-content.active { display: block; }
        /* Using .pin-container for profile content for now */

        /* Bottom Navigation */
        .bottom-nav {
            height: var(--bottom-nav-height);
            background-color: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed; bottom: 0; left: 0; right: 0;
            z-index: 100; max-width: inherit; margin: 0 auto;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: none; border: none; color: var(--text-secondary);
            padding: 4px 0; cursor: pointer; transition: color 0.2s;
        }
        .nav-item.active { color: var(--accent-primary); }
        .nav-item svg { width: 26px; height: 26px; fill: currentColor; margin-bottom: 3px; }
        .nav-item-profile .profile-avatar-nav {
            width: 28px; height: 28px; border-radius: 50%;
            background: linear-gradient(135deg, var(--text-secondary), #888);
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: var(--bg-primary); font-size: 0.9em;
            transition: box-shadow 0.2s;
        }
        .nav-item.active .nav-item-profile .profile-avatar-nav {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            box-shadow: 0 0 8px var(--accent-primary);
        }


        /* Toast Notification */
        #toast {
            visibility: hidden; min-width: 220px;
            background-color: var(--bg-tertiary); color: var(--text-primary);
            text-align: center; border-radius: var(--border-radius-main);
            padding: 14px 22px; position: fixed; z-index: 1002;
            left: 50%; bottom: calc(var(--bottom-nav-height) + 10px);
            transform: translateX(-50%); font-size: 0.9em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0; transition: opacity 0.3s ease, bottom 0.3s ease, visibility 0.3s ease;
        }
        #toast.show {
            visibility: visible; opacity: 1;
            bottom: calc(var(--bottom-nav-height) + 20px);
        }

    </style>
</head>
<body>

    <div class="app-shell">
        <header class="app-header">
            <div class="app-header-logo">Idea<span class="sparkle">Spark</span></div>
            <!-- Example: Settings button could go here -->
            <!-- <button class="header-action-button" aria-label="Settings">
                <svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg>
            </button> -->
        </header>

        <!-- Page Content Area -->
        <div id="homePage" class="page-content active">
            <div class="pin-container" id="pin-container-home">
                <!-- Home pins will be injected here -->
            </div>
        </div>

        <div id="discoverPage" class="page-content">
            <div class="search-bar-container">
                <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
                <input type="search" class="search-input" id="discoverSearchInput" placeholder="Search for sparks & ideas...">
            </div>
            <div class="mock-search-results" id="mockSearchResultsContainer">
                <!-- Mock search results appear here -->
            </div>
            <div id="discoverDefaultContent">
                <div class="discover-section-title">Trending Now ✨</div>
                <div class="category-tags">
                    <span class="category-tag">AI Art</span><span class="category-tag">Sustainable Living</span>
                    <span class="category-tag">VR Experiences</span><span class="category-tag">Future Tech</span>
                    <span class="category-tag">Bio-Hacking</span><span class="category-tag">Space Travel</span>
                </div>
                <div class="discover-section-title">Categories</div>
                <div class="category-tags">
                    <span class="category-tag">Design</span><span class="category-tag">Innovation</span>
                    <span class="category-tag">Lifestyle</span><span class="category-tag">Wellness</span>
                    <span class="category-tag">DIY</span><span class="category-tag">Code</span>
                </div>
            </div>
        </div>

        <div id="createPage" class="page-content">
            <div class="discover-section-title" style="text-align: center; margin-bottom: 24px;">Unleash Your Next Idea</div>
            <div class="create-options-grid">
                <div class="create-option-card" data-create-type="spark">
                    <svg viewBox="0 0 24 24"><path d="M12 2L9.19 8.63L2 11l6.18 5.37L6.81 22L12 17.31L17.19 22l-1.37-5.63L22 11l-7.19-2.37L12 2zm0 10.55L10.23 15.4L6.46 16l3.29 2.86L8.7 22.45L12 20.03l3.3 2.42l-1.05-3.59L17.54 16l-3.77-.6L12 12.55z"/></svg>
                    <p>New Spark</p>
                </div>
                <div class="create-option-card" data-create-type="board">
                    <svg viewBox="0 0 24 24"><path d="M4 4h6v6H4zm0 8h6v6H4zm8-8h6v6h-6zm0 8h6v6h-6zM2 2v20h20V2H2zm18 18H4V4h16v16z"/></svg>
                    <p>New Board</p>
                </div>
                <div class="create-option-card" data-create-type="ai_generate">
                    <span class="ai-sparkle"><svg viewBox="0 0 24 24"><path d="M19.64 7.03l-1.41-1.41L15.46 9.4l1.41 1.41L19.64 7.03m-5.66 1.41L12.56 7l-1.41 1.41L12.56 9.83l1.42-1.39M4.36 7.03l2.77 2.77L8.54 7l-1.41-1.41L4.36 7.03m11.09 9.19l2.77 2.77 1.41-1.41-2.77-2.77-1.41 1.41M12 22a1.5 1.5 0 01-1.5-1.5c0-.65.42-1.2 1-1.41V12h1v7.09c.58.21 1 .76 1 1.41A1.5 1.5 0 0112 22m-4.5-2c0 .65-.42 1.2-1 1.41V14h-1v7.09c-.58-.21-1-.76-1-1.41a1.5 1.5 0 013 0m9 0c0 .65-.42 1.2-1 1.41V14h-1v7.09c-.58-.21-1-.76-1-1.41a1.5 1.5 0 013 0M12 5a3 3 0 00-3 3h6a3 3 0 00-3-3z"/></svg></span>
                    <p>AI Generate</p>
                </div>
            </div>
        </div>

        <div id="updatesPage" class="page-content">
            <div class="discover-section-title" style="margin-bottom: 20px;">Your Feed</div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be injected here -->
            </div>
        </div>

        <div id="profilePage" class="page-content">
            <div class="profile-header">
                <div class="profile-avatar-large">I</div>
                <div class="profile-name">Innovator One</div>
                <div class="profile-username">@i_one_2025</div>
                <div class="profile-stats">
                    <div class="stat-item"><span class="count">1.2K</span><span class="label">Followers</span></div>
                    <div class="stat-item"><span class="count">345</span><span class="label">Following</span></div>
                    <div class="stat-item"><span class="count">87</span><span class="label">Sparks</span></div>
                </div>
            </div>
            <div class="profile-tabs">
                <div class="profile-tab active" data-profile-tab="sparks">My Sparks</div>
                <div class="profile-tab" data-profile-tab="boards">Boards</div>
                <div class="profile-tab" data-profile-tab="saved">Saved</div>
            </div>
            <div id="profileSparksContent" class="profile-tab-content active">
                 <div class="pin-container" id="pin-container-profile-sparks">
                    <!-- User's sparks will be injected here -->
                </div>
            </div>
            <div id="profileBoardsContent" class="profile-tab-content">
                <p style="text-align:center; color: var(--text-secondary); padding: 20px;">Mock board list would appear here.</p>
            </div>
            <div id="profileSavedContent" class="profile-tab-content">
                 <div class="pin-container" id="pin-container-profile-saved">
                    <!-- User's saved sparks will be injected here -->
                </div>
            </div>
        </div>


        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="homePage" aria-label="Home">
                <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>
            </button>
            <button class="nav-item" data-page="discoverPage" aria-label="Discover">
                <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path></svg>
            </button>
            <button class="nav-item" data-page="createPage" aria-label="Create">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>
            </button>
            <button class="nav-item" data-page="updatesPage" aria-label="Updates">
                 <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"></path></svg>
            </button>
            <button class="nav-item nav-item-profile" data-page="profilePage" aria-label="Profile">
                <div class="profile-avatar-nav">I</div>
            </button>
        </nav>

        <div id="toast">A message will show here</div>
    </div>

    <script>
        // --- App State & Elements ---
        const pages = document.querySelectorAll('.page-content');
        const navItems = document.querySelectorAll('.bottom-nav .nav-item');
        const toastElement = document.getElementById('toast');
        let activePageId = 'homePage';
        const savedPins = new Set(); // To track saved state of pins by ID

        // Pin Containers
        const pinContainerHome = document.getElementById('pin-container-home');
        const pinContainerProfileSparks = document.getElementById('pin-container-profile-sparks');
        const pinContainerProfileSaved = document.getElementById('pin-container-profile-saved');


        // --- Sample Data ---
        const samplePinsData = [
            { id: 's1', imageUrl: 'https://picsum.photos/seed/is1/250/350', title: 'Quantum Garden', user: 'BioFuturist', avatar: 'B' },
            { id: 's2', imageUrl: 'https://picsum.photos/seed/is2/250/420', title: 'AR City Overlay', user: 'UrbanTech', avatar: 'U' },
            { id: 's3', imageUrl: 'https://picsum.photos/seed/is3/250/300', title: 'Neural Net Art', user: 'AIGenius', avatar: 'A' },
            { id: 's4', imageUrl: 'https://picsum.photos/seed/is4/250/450', title: 'Zero-G Living', user: 'SpaceNomad', avatar: 'S' },
            { id: 's5', imageUrl: 'https://picsum.photos/seed/is5/250/380', title: 'Synthwave Drive', user: 'RetroWave', avatar: 'R' },
            { id: 's6', imageUrl: 'https://picsum.photos/seed/is6/250/320', title: 'Eco-Tower Concept', user: 'GreenArch', avatar: 'G' },
            { id: 's7', imageUrl: 'https://picsum.photos/seed/is7/250/400', title: 'Holographic Fashion', user: 'Style2077', avatar: 'S' },
            { id: 's8', imageUrl: 'https://picsum.photos/seed/is8/250/280', title: 'Mind Palace UI', user: 'CognitiveUX', avatar: 'C' },
        ];
        const userSparksData = samplePinsData.slice(0,4); // User created these
        const userSavedData = samplePinsData.slice(4,7);  // User saved these

        const sampleNotifications = [
            { type: 'like', user: 'NovaMind', item: 'Quantum Garden', time: '5m ago', icon: '❤️'},
            { type: 'comment', user: 'CypherPunk', item: 'AR City Overlay', text: 'This is revolutionary!', time: '1h ago', icon: '💬'},
            { type: 'follow', user: 'BioHackerEve', time: '3h ago', icon: '👤'},
            { type: 'board', user: 'NovaMind', item: 'Future Concepts', spark: 'Zero-G Living', time: '1d ago', icon: '➕'},
        ];

        // --- Pin Creation & Management ---
        function createPinElement(pinData, isInitiallySaved = false) {
            const pinDiv = document.createElement('div');
            pinDiv.classList.add('pin');
            pinDiv.dataset.id = pinData.id;

            const img = document.createElement('img');
            img.src = pinData.imageUrl;
            img.alt = pinData.title;
            img.loading = 'lazy';

            const contentDiv = document.createElement('div');
            contentDiv.classList.add('pin-content');
            const titleH3 = document.createElement('h3');
            titleH3.classList.add('pin-title');
            titleH3.textContent = pinData.title;
            const userDiv = document.createElement('div');
            userDiv.classList.add('pin-user');
            const avatarSpan = document.createElement('span');
            avatarSpan.classList.add('pin-user-avatar');
            avatarSpan.textContent = pinData.avatar || pinData.user.charAt(0).toUpperCase();
            const userNameSpan = document.createElement('span');
            userNameSpan.textContent = pinData.user;
            userDiv.append(avatarSpan, userNameSpan);
            contentDiv.append(titleH3, userDiv);

            const saveButton = document.createElement('button');
            saveButton.classList.add('pin-save-button');
            
            function updateSaveButtonState() {
                if (savedPins.has(pinData.id)) {
                    saveButton.textContent = 'Saved';
                    saveButton.classList.add('saved');
                } else {
                    saveButton.textContent = 'Save';
                    saveButton.classList.remove('saved');
                }
            }
            updateSaveButtonState(); // Initial state

            saveButton.addEventListener('click', (e) => {
                e.stopPropagation();
                if (savedPins.has(pinData.id)) {
                    savedPins.delete(pinData.id);
                    showToast(`"${pinData.title}" unsaved.`);
                } else {
                    savedPins.add(pinData.id);
                    showToast(`"${pinData.title}" saved!`);
                }
                updateSaveButtonState();
                // If on profile saved page, re-render that list
                if (activePageId === 'profilePage' && document.getElementById('profileSavedContent').classList.contains('active')) {
                    loadProfileSavedPins();
                }
            });

            pinDiv.append(img, contentDiv, saveButton);
            pinDiv.addEventListener('click', () => showToast(`Opening Spark: "${pinData.title}" (mock)`));
            return pinDiv;
        }

        function loadPins(container, data) {
            container.innerHTML = ''; // Clear existing
            data.forEach(pinData => {
                const pinElement = createPinElement(pinData, savedPins.has(pinData.id));
                container.appendChild(pinElement);
            });
        }

        // --- Page Navigation ---
        function switchPage(pageId) {
            pages.forEach(page => {
                page.classList.toggle('active', page.id === pageId);
            });
            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId);
            });
            activePageId = pageId;

            // Scroll to top of new page
            const activePageElement = document.getElementById(pageId);
            if (activePageElement) activePageElement.scrollTop = 0;

            // Load content if needed
            if (pageId === 'homePage') loadPins(pinContainerHome, samplePinsData);
            if (pageId === 'updatesPage') loadNotifications();
            if (pageId === 'profilePage') {
                // Default to 'sparks' tab on profile
                switchProfileTab('sparks');
            }
            if (pageId === 'discoverPage') { // Reset discover page state
                 document.getElementById('discoverSearchInput').value = '';
                 document.getElementById('mockSearchResultsContainer').innerHTML = '';
                 document.getElementById('discoverDefaultContent').style.display = 'block';
            }
        }

        navItems.forEach(item => {
            item.addEventListener('click', () => switchPage(item.dataset.page));
        });

        // --- Toast Notification ---
        let toastTimeout;
        function showToast(message) {
            if (toastTimeout) clearTimeout(toastTimeout);
            toastElement.textContent = message;
            toastElement.classList.add('show');
            toastTimeout = setTimeout(() => {
                toastElement.classList.remove('show');
            }, 2500);
        }

        // --- Discover Page Logic ---
        const discoverSearchInput = document.getElementById('discoverSearchInput');
        const mockSearchResultsContainer = document.getElementById('mockSearchResultsContainer');
        const discoverDefaultContent = document.getElementById('discoverDefaultContent');

        discoverSearchInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();
            if (query.length > 1) {
                mockSearchResultsContainer.innerHTML = ''; // Clear previous
                discoverDefaultContent.style.display = 'none';
                const results = samplePinsData.filter(pin => pin.title.toLowerCase().includes(query) || pin.user.toLowerCase().includes(query));
                if (results.length > 0) {
                    results.slice(0, 5).forEach(res => { // Show max 5 results
                        const item = document.createElement('div');
                        item.classList.add('result-item');
                        item.textContent = `Spark: ${res.title} by ${res.user}`;
                        item.onclick = () => showToast(`Opening search result: ${res.title}`);
                        mockSearchResultsContainer.appendChild(item);
                    });
                } else {
                    mockSearchResultsContainer.innerHTML = `<p style="text-align:center; color:var(--text-secondary); padding: 10px;">No sparks found for "${this.value}"</p>`;
                }
            } else {
                mockSearchResultsContainer.innerHTML = '';
                discoverDefaultContent.style.display = 'block';
            }
        });
        document.querySelectorAll('.category-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                discoverSearchInput.value = tag.textContent;
                discoverSearchInput.dispatchEvent(new Event('input')); // Trigger search
                showToast(`Exploring ${tag.textContent}`);
            });
        });

        // --- Create Page Logic ---
        document.querySelectorAll('.create-option-card').forEach(card => {
            card.addEventListener('click', () => {
                const type = card.dataset.createType;
                if (type === 'spark') showToast('Opening New Spark creator (mock)');
                else if (type === 'board') showToast('Opening New Board creator (mock)');
                else if (type === 'ai_generate') showToast('Initiating AI Image Generation (mock)... ✨');
            });
        });

        // --- Updates Page Logic ---
        const notificationList = document.getElementById('notificationList');
        function loadNotifications() {
            notificationList.innerHTML = '';
            sampleNotifications.forEach(notif => {
                const item = document.createElement('div');
                item.classList.add('notification-item');
                const icon = document.createElement('div');
                icon.classList.add('notification-icon');
                if (notif.type === 'comment') icon.classList.add('comment');
                icon.textContent = notif.icon;
                const textDiv = document.createElement('div');
                textDiv.classList.add('notification-text');
                const p1 = document.createElement('p');
                if (notif.type === 'like') p1.innerHTML = `<strong>${notif.user}</strong> liked your spark <strong>${notif.item}</strong>.`;
                else if (notif.type === 'comment') p1.innerHTML = `<strong>${notif.user}</strong> commented on <strong>${notif.item}</strong>: "${notif.text}"`;
                else if (notif.type === 'follow') p1.innerHTML = `<strong>${notif.user}</strong> started following you.`;
                else if (notif.type === 'board') p1.innerHTML = `<strong>${notif.user}</strong> added your spark <strong>${notif.spark}</strong> to their board <strong>${notif.item}</strong>.`;
                const timeP = document.createElement('p');
                timeP.classList.add('time');
                timeP.textContent = notif.time;
                textDiv.append(p1, timeP);
                item.append(icon, textDiv);
                item.onclick = () => showToast(`Opening notification (mock)`);
                notificationList.appendChild(item);
            });
        }

        // --- Profile Page Logic ---
        const profileTabs = document.querySelectorAll('.profile-tab');
        const profileTabContents = document.querySelectorAll('.profile-tab-content');

        function loadProfileSparks() {
            loadPins(pinContainerProfileSparks, userSparksData);
        }
        function loadProfileSavedPins() {
            const actualSavedPinsData = samplePinsData.filter(pin => savedPins.has(pin.id));
            loadPins(pinContainerProfileSaved, actualSavedPinsData);
            if (actualSavedPinsData.length === 0 && pinContainerProfileSaved) {
                pinContainerProfileSaved.innerHTML = `<p style="text-align:center; color: var(--text-secondary); padding: 20px;">No saved sparks yet. Explore and save some!</p>`;
            }
        }

        function switchProfileTab(tabId) {
            profileTabs.forEach(tab => tab.classList.toggle('active', tab.dataset.profileTab === tabId));
            profileTabContents.forEach(content => content.classList.toggle('active', content.id === `profile${tabId.charAt(0).toUpperCase() + tabId.slice(1)}Content`));
            
            if (tabId === 'sparks') loadProfileSparks();
            if (tabId === 'boards') { /* Load boards if implemented */ }
            if (tabId === 'saved') loadProfileSavedPins();
        }
        profileTabs.forEach(tab => {
            tab.addEventListener('click', () => switchProfileTab(tab.dataset.profileTab));
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            switchPage('homePage'); // Load initial page
             // Initialize saved pins from sample data (userSavedData)
            userSavedData.forEach(pin => savedPins.add(pin.id));
        });

    </script>
</body>
</html>
