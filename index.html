<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TingTong</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Basic Setup */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%; /* Use 100dvh for dynamic viewport height in modern browsers */
            height: 100dvh;
            overflow: hidden;
            background-color: #000;
            color: #fff;
        }

        /* App Container - Enforces 9:16 on larger screens for testing */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 450px; /* Approx 9:16 at 800px height for desktop testing */
            margin: 0 auto;
            position: relative;
            background-color: #000;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Crucial */
        }

        /* Video Feed Area */
        .video-feed {
            flex-grow: 1;
            position: relative;
            overflow: hidden; /* To contain videos */
        }

        .video-slide {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease-out; /* For swipe animation */
            background-color: #000; /* Fallback if video doesn't load */
        }

        .video-slide video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Crucial for full screen video */
        }

        /* Video Overlay UI */
        .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%; /* Cover entire video */
            padding: 15px;
            padding-bottom: 70px; /* Space for bottom nav */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            background: linear-gradient(to top, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 40%);
            pointer-events: none; /* Allow clicks to pass through to video by default */
        }
        .video-overlay > * {
            pointer-events: auto; /* Re-enable pointer events for children */
        }

        .video-details {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .user-info .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #fff;
            margin-right: 8px;
            object-fit: cover;
        }

        .user-info .username {
            font-weight: bold;
            font-size: 1.1em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        .user-info .username:hover {
            text-decoration: underline;
        }

        .video-description {
            font-size: 0.9em;
            line-height: 1.3;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            max-height: 4.0em; /* Approx 3 lines */
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .video-description .hashtag {
            font-weight: bold;
            cursor: pointer;
        }
        .video-description .hashtag:hover {
            text-decoration: underline;
        }

        .music-info {
            display: flex;
            align-items: center;
            font-size: 0.85em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        .music-info .icon {
            margin-right: 5px;
        }
        .music-info .music-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            animation: marquee 10s linear infinite paused; /* Paused by default */
            max-width: 60%; /* Adjust as needed */
        }
        .video-slide.active .music-name {
            animation-play-state: running;
        }

        @keyframes marquee {
            0%   { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }
        
        .video-actions {
            position: absolute;
            right: 10px;
            bottom: 75px; /* Above nav bar */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        .action-button i {
            font-size: 2em; /* Larger icons */
        }
        .action-button span {
            font-size: 0.8em;
            margin-top: 4px;
            font-weight: 500;
        }
        .action-button.liked i {
            color: #fe2c55; /* TikTok pink/red */
        }

        .action-button .profile-action-pic {
             width: 45px;
             height: 45px;
             border-radius: 50%;
             border: 2px solid #fff;
             object-fit: cover;
             margin-bottom: -5px; /* Overlap the plus icon */
        }
        .action-button .follow-plus {
            width: 20px;
            height: 20px;
            background-color: #fe2c55;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            position: relative;
            top: -10px; /* Position it under the profile pic */
            border: 1px solid white;
        }


        .sound-disc {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #333, #555);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: spin 4s linear infinite paused; /* Paused by default */
        }
        .video-slide.active .sound-disc {
            animation-play-state: running;
        }

        .sound-disc::before {
            content: '';
            width: 20px;
            height: 20px;
            background-color: #111;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(255,255,255,0.3);
        }
        .sound-disc::after { /* musical note */
            content: '\f001'; /* Font Awesome music icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            font-size: 1.2em;
            color: rgba(255,255,255,0.5);
            /* For better visual, could use an image or more complex SVG */
        }


        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Bottom Navigation */
        .bottom-nav {
            height: 60px;
            background-color: #000;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 450px; /* Match app-container */
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #aaa;
            font-size: 0.7em;
            cursor: pointer;
            padding: 5px 0;
        }
        .nav-item i {
            font-size: 1.6em;
            margin-bottom: 3px;
        }
        .nav-item.active {
            color: #fff;
        }
        .nav-item.create-btn i {
            font-size: 2.2em; /* Larger create button */
            padding: 5px 10px;
            background-color: #fff;
            color: #000;
            border-radius: 8px;
            /* Simulating the dual color effect of TikTok's plus */
            position: relative;
        }
         .nav-item.create-btn i::before {
            /* content: ''; This is for the icon itself */
        }
        .nav-item.create-btn i::after {
            content: '';
            position: absolute;
            width: 80%;
            height: 100%;
            top: 0;
            left: 10%;
            border-radius: 6px;
            /* You'd typically use pseudo elements for the blue/red parts of the + */
        }


        /* Loading spinner (optional) */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            z-index: 10;
            display: none; /* Hidden by default */
        }
        .video-slide.loading .loading-spinner {
            display: block;
        }

        /* Pause/Play icon overlay */
        .play-pause-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            color: rgba(255, 255, 255, 0.7);
            opacity: 0;
            transition: opacity 0.2s ease-out;
            pointer-events: none; /* Don't interfere with clicks */
            z-index: 5; /* Above video, below other UI elements */
        }
        .play-pause-overlay.visible {
            opacity: 1;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <div class="video-feed" id="videoFeed">
            <!-- Video slides will be injected here by JavaScript -->
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" data-tab="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" data-tab="discover">
                <i class="fas fa-search"></i>
                <span>Discover</span>
            </div>
            <div class="nav-item create-btn" data-tab="create">
                <i class="fas fa-plus"></i>
            </div>
            <div class="nav-item" data-tab="inbox">
                <i class="fas fa-comment-dots"></i> <!-- Or fa-inbox -->
                <span>Inbox</span>
            </div>
            <div class="nav-item" data-tab="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
        </div>
    </div>

    <script>
        const videosData = [
            {
                id: 1,
                src: "https://assets.mixkit.co/videos/preview/mixkit-father-and-daughter-playing-in-the-meadow-at-sunset-43096-large.mp4", // Replace with your video URL
                user: "NatureLover123",
                profilePic: "https://randomuser.me/api/portraits/women/65.jpg", // Replace with actual image
                description: "Beautiful sunset walk! 🌅 #nature #sunset #peaceful #vibes",
                songName: "Original Sound - NatureLover123",
                likes: 12345,
                comments: 678,
                shares: 910
            },
            {
                id: 2,
                src: "https://assets.mixkit.co/videos/preview/mixkit-aerial-view-of-a-winding-road-in-the-forest-4 winding-road-in-the-forest-424 winding-road-in-the-forest-424 winding-road-in-the-forest-424 winding-road-in-the-forest-424 winding-road-in-the-forest-424 winding-road-in-the-forest-42401-large.mp4", // Replace with your video URL
                user: "AdventureSeeker",
                profilePic: "https://randomuser.me/api/portraits/men/43.jpg",
                description: "Drone shots from my latest trip! 🚁 #travel #adventure #drone #explore",
                songName: "Upbeat Electronic - Cool Artist",
                likes: 25000,
                comments: 1200,
                shares: 1500
            },
            {
                id: 3,
                src: "https://assets.mixkit.co/videos/preview/mixkit-woman-doing-yoga-exercises-on-a-mat-outdoors-4010-large.mp4", // Replace with your video URL
                user: "YogaLife",
                profilePic: "https://randomuser.me/api/portraits/women/75.jpg",
                description: "Morning yoga flow to start the day right. 🙏 #yoga #mindfulness #health",
                songName: "Calming Sounds - Zen Master",
                likes: 18000,
                comments: 850,
                shares: 700
            },
            {
                id: 4,
                src: "https://assets.mixkit.co/videos/preview/mixkit-surfer-riding-a-wave-with-his-board-42340-large.mp4", // Replace with your video URL
                user: "SurferDude",
                profilePic: "https://randomuser.me/api/portraits/men/32.jpg",
                description: "Catching some waves! 🏄‍♂️ #surf #ocean #beachlife",
                songName: "Surf Rock Anthem - The Wave Riders",
                likes: 32000,
                comments: 1500,
                shares: 1100
            }
            // Add more video objects here
        ];

        const videoFeed = document.getElementById('videoFeed');
        let currentVideoIndex = 0;
        let videoElements = [];
        let touchStartY = 0;
        let touchMoveY = 0;
        const swipeThreshold = 50; // Minimum pixels to be considered a swipe

        function createVideoSlide(videoData, index) {
            const slide = document.createElement('div');
            slide.classList.add('video-slide');
            slide.dataset.index = index;
            slide.style.transform = `translateY(${index * 100}%)`; // Position for initial stack

            const video = document.createElement('video');
            video.src = videoData.src;
            video.loop = true;
            video.playsInline = true; // Important for iOS
            video.muted = true; // Autoplay often requires muted
            // video.preload = "auto"; // Handled by play logic

            const loadingSpinner = document.createElement('div');
            loadingSpinner.classList.add('loading-spinner');
            slide.appendChild(loadingSpinner);
            
            slide.appendChild(video);

            const overlay = document.createElement('div');
            overlay.classList.add('video-overlay');
            overlay.innerHTML = `
                <div class="video-details">
                    <div class="user-info">
                        <img src="${videoData.profilePic}" alt="${videoData.user}" class="profile-pic">
                        <span class="username">@${videoData.user}</span>
                    </div>
                    <p class="video-description">${parseDescription(videoData.description)}</p>
                    <div class="music-info">
                        <i class="fas fa-music icon"></i>
                        <span class="music-name">${videoData.songName}</span>
                    </div>
                </div>
                <div class="video-actions">
                    <div class="action-button user-profile-action">
                        <img src="${videoData.profilePic}" alt="${videoData.user}" class="profile-action-pic">
                        <div class="follow-plus">+</div>
                    </div>
                    <div class="action-button like-button" data-video-id="${videoData.id}">
                        <i class="fas fa-heart"></i>
                        <span>${formatCount(videoData.likes)}</span>
                    </div>
                    <div class="action-button comment-button">
                        <i class="fas fa-comment-dots"></i>
                        <span>${formatCount(videoData.comments)}</span>
                    </div>
                    <div class="action-button share-button">
                        <i class="fas fa-share"></i>
                        <span>${formatCount(videoData.shares)}</span>
                    </div>
                    <div class="action-button sound-disc-action">
                        <div class="sound-disc"></div>
                    </div>
                </div>
                <div class="play-pause-overlay">
                    <i class="fas fa-play"></i>
                </div>
            `;
            slide.appendChild(overlay);
            
            video.addEventListener('loadeddata', () => {
                slide.classList.remove('loading');
                loadingSpinner.style.display = 'none';
            });
            video.addEventListener('waiting', () => {
                slide.classList.add('loading');
                loadingSpinner.style.display = 'block';
            });
            video.addEventListener('playing', () => {
                slide.classList.remove('loading');
                loadingSpinner.style.display = 'none';
            });


            // Tap to play/pause
            slide.addEventListener('click', (e) => {
                // Prevent click if target is an interactive element in overlay
                if (e.target.closest('.action-button') || e.target.closest('.user-info') || e.target.closest('.hashtag')) {
                    return;
                }
                togglePlayPause(video, slide);
            });

            // Like button functionality (visual only)
            const likeButton = overlay.querySelector('.like-button');
            likeButton.addEventListener('click', () => {
                likeButton.classList.toggle('liked');
                const likeCountElement = likeButton.querySelector('span');
                let currentLikes = parseInt(likeCountElement.textContent.replace(/K|M/g, d => d === 'K' ? '000' : '000000'));
                
                if (likeButton.classList.contains('liked')) {
                    currentLikes++;
                } else {
                    currentLikes--;
                }
                // Update original data (not persistent)
                const originalVideoData = videosData.find(v => v.id === videoData.id);
                if(originalVideoData) originalVideoData.likes = currentLikes;

                likeCountElement.textContent = formatCount(currentLikes);
            });

            return slide;
        }
        
        function togglePlayPause(video, slide) {
            const playPauseIcon = slide.querySelector('.play-pause-overlay i');
            const playPauseOverlay = slide.querySelector('.play-pause-overlay');
            if (video.paused) {
                video.play().catch(error => console.error("Play error:", error));
                playPauseIcon.classList.remove('fa-play');
                playPauseIcon.classList.add('fa-pause');
            } else {
                video.pause();
                playPauseIcon.classList.remove('fa-pause');
                playPauseIcon.classList.add('fa-play');
            }
            // Show icon briefly
            playPauseOverlay.classList.add('visible');
            setTimeout(() => {
                playPauseOverlay.classList.remove('visible');
            }, 500);
        }

        function parseDescription(description) {
            return description.replace(/#(\w+)/g, '<span class="hashtag">#$1</span>');
        }

        function formatCount(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
            }
            return num.toString();
        }

        function initFeed() {
            videosData.forEach((videoData, index) => {
                const slide = createVideoSlide(videoData, index);
                videoFeed.appendChild(slide);
                videoElements.push(slide);
            });
            loadVideo(currentVideoIndex);
        }

        function loadVideo(index, direction = 0) {
            if (index < 0 || index >= videoElements.length) {
                // Optional: Loop back
                // if (index < 0) currentVideoIndex = videoElements.length - 1;
                // if (index >= videoElements.length) currentVideoIndex = 0;
                // index = currentVideoIndex;
                return; // Or handle looping
            }

            videoElements.forEach((slide, i) => {
                const video = slide.querySelector('video');
                const slideIndex = parseInt(slide.dataset.index);
                
                // Position slides for swiping animation
                if (direction === 0) { // Initial load or direct jump
                    slide.style.transform = `translateY(${(slideIndex - index) * 100}%)`;
                } else if (direction < 0) { // Swiping up (next video)
                    if (slideIndex < index) { // slide is above current, move it out of view upwards
                        slide.style.transform = `translateY(-200%)`; // or more
                    } else {
                        slide.style.transform = `translateY(${(slideIndex - index) * 100}%)`;
                    }
                } else { // Swiping down (previous video)
                     if (slideIndex > index) { // slide is below current, move it out of view downwards
                        slide.style.transform = `translateY(200%)`; // or more
                    } else {
                        slide.style.transform = `translateY(${(slideIndex - index) * 100}%)`;
                    }
                }


                if (i === index) {
                    slide.classList.add('active');
                    slide.style.zIndex = 1; // Bring current video to top
                    if (video.readyState >= 3) { // HAVE_FUTURE_DATA or more
                        video.play().catch(error => console.error("Autoplay failed:", error));
                    } else {
                        video.addEventListener('canplay', () => {
                           video.play().catch(error => console.error("Autoplay after canplay failed:", error));
                        }, { once: true });
                    }
                    // Unmute current video, mute others (optional, if you want sound control)
                    video.muted = false; 
                } else {
                    slide.classList.remove('active');
                    video.pause();
                    video.currentTime = 0; // Reset inactive videos
                    slide.style.zIndex = 0;
                    video.muted = true; // Mute non-active videos
                }
            });
            currentVideoIndex = index;
        }

        // Swipe Controls
        videoFeed.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            touchMoveY = touchStartY; // Initialize touchMoveY
            // Pause transitions on all slides during touch to make it feel more direct
            videoElements.forEach(slide => slide.style.transition = 'none');
        });

        videoFeed.addEventListener('touchmove', (e) => {
            touchMoveY = e.touches[0].clientY;
            const deltaY = touchMoveY - touchStartY;

            // Move current, next, and previous slides with the finger
            const currentSlide = videoElements[currentVideoIndex];
            if (currentSlide) currentSlide.style.transform = `translateY(${deltaY}px)`;

            if (deltaY < 0) { // Swiping up
                const nextSlide = videoElements[currentVideoIndex + 1];
                if (nextSlide) nextSlide.style.transform = `translateY(calc(100% + ${deltaY}px))`;
            } else { // Swiping down
                const prevSlide = videoElements[currentVideoIndex - 1];
                if (prevSlide) prevSlide.style.transform = `translateY(calc(-100% + ${deltaY}px))`;
            }
        });

        videoFeed.addEventListener('touchend', () => {
            // Restore transitions
            videoElements.forEach(slide => slide.style.transition = 'transform 0.3s ease-out');

            const deltaY = touchMoveY - touchStartY;
            let newIndex = currentVideoIndex;
            let direction = 0;

            if (Math.abs(deltaY) > swipeThreshold) {
                if (deltaY < 0 && currentVideoIndex < videoElements.length - 1) { // Swipe Up
                    newIndex++;
                    direction = -1;
                } else if (deltaY > 0 && currentVideoIndex > 0) { // Swipe Down
                    newIndex--;
                    direction = 1;
                }
            }
            // This will snap back or to the new video
            loadVideo(newIndex, direction);
        });

        // Keyboard controls for desktop testing
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' && currentVideoIndex < videoElements.length - 1) {
                loadVideo(currentVideoIndex + 1, -1);
            } else if (e.key === 'ArrowDown' && currentVideoIndex > 0) {
                loadVideo(currentVideoIndex - 1, 1);
            } else if (e.key === ' ') { // Spacebar for play/pause
                e.preventDefault(); // Prevent page scroll
                const activeSlide = videoElements[currentVideoIndex];
                if (activeSlide) {
                    const video = activeSlide.querySelector('video');
                    togglePlayPause(video, activeSlide);
                }
            }
        });
        
        // Bottom Nav item click (visual only for now)
        const navItems = document.querySelectorAll('.bottom-nav .nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                if (item.dataset.tab === 'create') {
                    alert('Create feature coming soon!'); // Placeholder
                    return;
                }
                if (item.dataset.tab !== 'home') {
                    alert(`Navigating to ${item.dataset.tab} (not implemented)`);
                     // Don't change active state for non-home tabs yet
                    return;
                }
                navItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                // Potentially reload feed or change view if not home
            });
        });

        // Initialize
        initFeed();

    </script>
</body>
</html>
